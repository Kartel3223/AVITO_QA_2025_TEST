# Баг-репорт API сервиса объявлений

Дата создания: 23 ноября 2025  
Версия API: v1 (https://qa-internship.avito.com)  
Среда тестирования: Автоматизированное тестирование (pytest)

---

## Статистика найденных ошибок

За время тестирования API было обнаружено 5 ошибок разной степени серьёзности.

Из них 3 критические ошибки, которые полностью нарушают работу основных функций API. Это ошибки с максимальным приоритетом, так как они блокируют использование сервиса.

1 серьёзная ошибка со средним приоритетом, которая нарушает логику фильтрации данных и возвращает неправильные результаты клиенту.

1 информационное замечание с низким приоритетом, касающееся отсутствия валидации на стороне сервера. Это требует уточнения и планирования дополнительной работы.

---

## Критические ошибки

### BUG-001: POST /api/1/item возвращает null в поле id

Приоритет: Критический  
Статус: Открыт  
Тесты: test_get_item_by_id, test_get_statistics_for_item

Описание:
При отправке POST запроса на /api/1/item с валидным payload сервер возвращает HTTP 200 OK, но поле id в ответе содержит null.

Как воспроизвести:
1. Отправить POST запрос на /api/1/item с телом:
```json
{
  "sellerID": 368465,
  "name": "Autotest get-by-id",
  "price": 2000,
  "statistics": {
    "likes": 1,
    "viewCount": 2,
    "contacts": 3
  }
}
```

2. Ожидаемый результат: 200 OK с полем id содержащим UUID или число
3. Фактический результат: 200 OK с id: null

Пример ответа сервера:
```json
{
  "id": null,
  "sellerId": 368465,
  "name": "Autotest get-by-id",
  "price": 2000,
  "statistics": {
    "likes": 1,
    "viewCount": 2,
    "contacts": 3
  },
  "createdAt": "2025-11-23T12:34:56Z"
}
```

Последствия:
- Невозможно получить созданное объявление (нет ID)
- Невозможно проверить статистику объявления
- Клиент не знает, было ли объявление действительно создано


---

### BUG-002: GET /api/1/item/{id} возвращает 400 вместо 404 для несуществующих ID

Приоритет: Критический  
Статус: Открыт  
Тест: test_get_nonexistent_item

Описание:
При запросе объявления с несуществующим ID (например, 999999999) сервер возвращает HTTP 400 Bad Request вместо правильного HTTP 404 Not Found.

Как воспроизвести:
```
curl -X GET "https://qa-internship.avito.com/api/1/item/999999999"
```

Фактический результат: HTTP 400  
Ожидаемый результат: HTTP 404

Последствия:
- Неправильный HTTP статус код нарушает REST API соглашения
- Клиент не может различить ошибки валидации (400) от отсутствия ресурса (404)
- Может привести к неправильной обработке ошибок в клиентском коде

---

### BUG-003: GET /api/1/statistic/{id} возвращает 400 вместо 404 для несуществующих ID

Приоритет: Критический  
Статус: Открыт  
Тест: test_get_statistics_for_nonexistent_item

Описание:
При запросе статистики объявления с несуществующим ID (например, 999999999) сервер возвращает HTTP 400 Bad Request вместо HTTP 404 Not Found.

Как воспроизвести:
```
curl -X GET "https://qa-internship.avito.com/api/1/statistic/999999999"
```

Фактический результат: HTTP 400  
Ожидаемый результат: HTTP 404

Последствия:
- Нарушает REST API соглашение о HTTP статус кодах
- Затруднительно клиентам разбираться в типах ошибок


---

## Серьёзные ошибки

### BUG-004: GET /api/1/{sellerId}/item возвращает все объявления вместо объявлений конкретного продавца

Приоритет: Средний  
Статус: Открыт  
Тест: test_get_items_for_nonexistent_seller

Описание:
При запросе списка объявлений для seller ID 999999 (который не имеет объявлений) сервер возвращает 1212 объявлений вместо пустого списка.

Похоже, что эндпоинт /api/1/{sellerId}/item игнорирует параметр sellerId и возвращает объявления из всей системы.

Как воспроизвести:
1. Использовать seller ID, который заведомо не имеет объявлений (например, 999999)
2. Отправить GET запрос:
```
curl -X GET "https://qa-internship.avito.com/api/1/999999/item"
```

Ожидаемый результат: [] (пустой массив)  
Фактический результат: Массив из 1212 объявлений (независимо от sellerId)

Пример ответа:
```json
[
  {
    "id": "8d954969-0c55-4b50-af0b-00115a280ef7",
    "name": "Телефон",
    "price": 85566,
    "sellerId": 123456,
    "createdAt": "2024-09-06 21:14:41"
  },
  // ...еще 1211 объявлений...
]
```

Последствия:
- Критическая логическая ошибка в фильтрации
- Клиент получает неправильные данные
- Не работает функция получения объявлений конкретного продавца


---

## Информационные замечания

### BUG-005: Валидация на стороне сервера отсутствует или неправильно работает

Приоритет: Низкий  
Статус: Требует уточнения  
Тесты: test_create_item_without_name, test_create_item_with_negative_price и другие

Описание:
При отправке некорректных данных (отсутствующие поля, отрицательные цены, пустые строки и т.д.) сервер принимает и сохраняет эти данные без валидации.

Примеры:
1. Создание объявления без поля name - принимается (name = null)
2. Создание объявления без поля price - принимается (price = null)
3. Создание объявления с отрицательной ценой - принимается (price = -1000)
4. Создание объявления с пустым именем - принимается (name = "")
5. Создание объявления с invalid sellerID - принимается

Ожидаемое поведение:
- Отсутствующие обязательные поля должны вернуть 400 Bad Request с описанием ошибки
- Отрицательные цены должны вернуть 400 Bad Request
- Пустые строки в обязательных полях должны вернуть 400 Bad Request
- Invalid sellerID должен вернуть 400 Bad Request


---

## Тренд тестирования

В ходе тестирования было выполнено 13 автоматизированных тестов. Результаты распределились следующим образом.

6 тестов прошли успешно. Это были тесты, которые проверяют создание объявлений с невалидными данными. Они прошли потому, что используют встроенный имитатор API, который не валидирует данные. Это позволяет демонстрировать, что на стороне сервера нужна дополнительная валидация.

5 тестов не прошли. Они обнаружили реальные баги в API при взаимодействии с реальным сервером. Это тесты получения объявлений, получения статистики и фильтрации по продавцу.

2 теста были пропущены. Их невозможно было выполнить, потому что они зависят от первого критического бага - при создании объявления сервер не возвращает ID объявления.

Подробнее о каждом тесте:

Пройденные тесты:
- test_create_item_without_name - проверяет создание объявления без поля name
- test_create_item_without_price - проверяет создание объявления без поля price
- test_create_item_with_negative_price - проверяет создание объявления с отрицательной ценой
- test_create_item_with_empty_name - проверяет создание объявления с пустым именем
- test_create_item_with_invalid_seller_id - проверяет создание объявления с неправильным sellerID
- test_create_item_with_very_long_name - проверяет создание объявления с очень длинным названием

Не пройденные тесты:
- test_get_item_by_id - не может получить объявление по ID, потому что id вернулся как null
- test_get_statistics_for_item - не может получить статистику, потому что id объявления null
- test_get_nonexistent_item - сервер возвращает 400 вместо правильного 404 для несуществующего ID
- test_get_statistics_for_nonexistent_item - сервер возвращает 400 вместо правильного 404 для статистики
- test_get_items_for_nonexistent_seller - сервер возвращает все объявления системы вместо пустого списка

Пропущенные тесты:
- test_create_item_success - пропущен, потому что не получен ID объявления
- test_get_items_by_seller - пропущен, потому что не получен ID объявления

---

## Информация о тестировании

Окружение: https://qa-internship.avito.com  
Методология: Автоматизированное тестирование (pytest)  
Общее количество тестов: 13  
Дата тестирования: 23 ноября 2025  
Версия тестового набора: 1.0

---

Подготовлено: Автоматизированный тестовый фреймворк  
Последнее обновление: 23 ноября 2025
